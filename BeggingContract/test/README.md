# MyNFT æµ‹è¯•å¥—ä»¶

æœ¬ç›®å½•åŒ…å«äº†MyNFTæ™ºèƒ½åˆçº¦çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼Œè¦†ç›–äº†æ‰€æœ‰ä¸»è¦åŠŸèƒ½å’Œè¾¹ç•Œæ¡ä»¶ã€‚

## æµ‹è¯•æ–‡ä»¶è¯´æ˜

### 1. MyNFT.test.ts
ä¸»è¦çš„å•å…ƒæµ‹è¯•æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹æµ‹è¯•æ¨¡å—ï¼š

- **åˆå§‹åŒ–æµ‹è¯•**: éªŒè¯åˆçº¦æ­£ç¡®åˆå§‹åŒ–ï¼ŒåŒ…æ‹¬åç§°ã€ç¬¦å·ã€ç‰ˆç¨ç­‰
- **é“¸é€ åŠŸèƒ½æµ‹è¯•**: æµ‹è¯•NFTé“¸é€ ã€ä¾›åº”é‡é™åˆ¶ã€æƒé™æ§åˆ¶
- **ç‰ˆç¨åŠŸèƒ½æµ‹è¯•**: æµ‹è¯•ERC2981ç‰ˆç¨æ ‡å‡†çš„å®ç°
- **æš‚åœåŠŸèƒ½æµ‹è¯•**: æµ‹è¯•ç´§æ€¥æš‚åœæœºåˆ¶
- **é”€æ¯åŠŸèƒ½æµ‹è¯•**: æµ‹è¯•NFTé”€æ¯åŠŸèƒ½
- **åŸºç¡€åŠŸèƒ½æµ‹è¯•**: æµ‹è¯•token URIã€æŸ¥è¯¢å‡½æ•°ç­‰åŸºç¡€åŠŸèƒ½
- **è®¿é—®æ§åˆ¶æµ‹è¯•**: éªŒè¯åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
- **å‡çº§åŠŸèƒ½æµ‹è¯•**: æµ‹è¯•åˆçº¦å‡çº§æœºåˆ¶
- **è¾¹ç•Œæ¡ä»¶æµ‹è¯•**: æµ‹è¯•æç«¯æƒ…å†µä¸‹çš„è¡Œä¸º

### 2. MyNFT.gas.test.ts
Gasæ¶ˆè€—åˆ†ææµ‹è¯•ï¼Œç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼š

- **éƒ¨ç½²æˆæœ¬åˆ†æ**: åˆçº¦éƒ¨ç½²çš„gasæ¶ˆè€—
- **æ“ä½œæˆæœ¬åˆ†æ**: é“¸é€ ã€è½¬ç§»ã€ç‰ˆç¨è®¾ç½®ç­‰æ“ä½œçš„gasæ¶ˆè€—
- **æ‰¹é‡æ“ä½œæµ‹è¯•**: åˆ†ææ‰¹é‡æ“ä½œçš„æ•ˆç‡
- **æ€§èƒ½ä¼˜åŒ–å»ºè®®**: æä¾›gasä¼˜åŒ–å»ºè®®

### 3. MyNFT.integration.test.ts
é›†æˆæµ‹è¯•ï¼Œæ¨¡æ‹ŸçœŸå®ä½¿ç”¨åœºæ™¯ï¼š

- **å®Œæ•´å·¥ä½œæµç¨‹æµ‹è¯•**: ä»é“¸é€ åˆ°é”€æ¯çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
- **å¤šç”¨æˆ·åœºæ™¯æµ‹è¯•**: å¤šä¸ªç”¨æˆ·åŒæ—¶ä½¿ç”¨åˆçº¦çš„åœºæ™¯
- **ç‰ˆç¨é›†æˆæµ‹è¯•**: å¤æ‚çš„ç‰ˆç¨è®¡ç®—åœºæ™¯
- **å‡çº§é›†æˆæµ‹è¯•**: å‡çº§åæ•°æ®ä¸€è‡´æ€§éªŒè¯

### 4. MyNFT.deployment.test.ts
éƒ¨ç½²ç›¸å…³çš„æµ‹è¯•ï¼š

- **Hardhat Upgradeséƒ¨ç½²æµ‹è¯•**: ä½¿ç”¨å‡çº§æ’ä»¶çš„éƒ¨ç½²éªŒè¯
- **éƒ¨ç½²å‚æ•°éªŒè¯**: åˆå§‹åŒ–å‚æ•°çš„éªŒè¯
- **ç½‘ç»œå…¼å®¹æ€§æµ‹è¯•**: ä¸åŒç½‘ç»œä¸‹çš„éƒ¨ç½²æµ‹è¯•

## è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
npx hardhat test
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
npx hardhat test test/MyNFT.test.ts

# è¿è¡Œç±»å‹å®‰å…¨æµ‹è¯•
npx hardhat test test/MyNFT.typesafe.test.ts

# è¿è¡ŒGasåˆ†ææµ‹è¯•
npx hardhat test test/MyNFT.gas.test.ts

# è¿è¡Œé›†æˆæµ‹è¯•
npx hardhat test test/MyNFT.integration.test.ts

# è¿è¡Œéƒ¨ç½²æµ‹è¯•
npx hardhat test test/MyNFT.deployment.test.ts
```

### è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹
```bash
# è¿è¡Œåˆå§‹åŒ–ç›¸å…³æµ‹è¯•
npx hardhat test --grep "åˆå§‹åŒ–"

# è¿è¡Œé“¸é€ åŠŸèƒ½æµ‹è¯•
npx hardhat test --grep "é“¸é€ åŠŸèƒ½"

# è¿è¡ŒGasç›¸å…³æµ‹è¯•
npx hardhat test --grep "gas"

# è¿è¡Œç±»å‹å®‰å…¨æµ‹è¯•
npx hardhat test --grep "ç±»å‹å®‰å…¨"

# è¿è¡Œé›†æˆæµ‹è¯•
npx hardhat test --grep "é›†æˆæµ‹è¯•"
```

### å¯ç”¨GasæŠ¥å‘Š
```bash
REPORT_GAS=true npx hardhat test
```

### TypeScriptç±»å‹æ£€æŸ¥
```bash
# ç¼–è¯‘æ£€æŸ¥TypeScriptç±»å‹
npx hardhat compile

# æ£€æŸ¥ç±»å‹å®šä¹‰
npx tsc --noEmit
```

## æµ‹è¯•è¦†ç›–ç‡

æœ¬æµ‹è¯•å¥—ä»¶è¦†ç›–äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

### âœ… å·²è¦†ç›–çš„åŠŸèƒ½
- [x] åˆçº¦åˆå§‹åŒ–å’Œé…ç½®
- [x] NFTé“¸é€  (åŒ…æ‹¬ä¾›åº”é‡é™åˆ¶)
- [x] ERC2981ç‰ˆç¨æ ‡å‡†
- [x] æš‚åœ/æ¢å¤æœºåˆ¶
- [x] NFTé”€æ¯åŠŸèƒ½
- [x] åŸºç¡€ERC721åŠŸèƒ½ (è½¬ç§»ã€æŸ¥è¯¢ç­‰)
- [x] è®¿é—®æ§åˆ¶å’Œæƒé™ç®¡ç†
- [x] åˆçº¦å‡çº§æœºåˆ¶
- [x] Gasæ¶ˆè€—åˆ†æ
- [x] é›†æˆæµ‹è¯•åœºæ™¯
- [x] é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶

### âš ï¸ éœ€è¦æ³¨æ„çš„é—®é¢˜
å½“å‰æµ‹è¯•ä¸­çš„ä¸€äº›å¤±è´¥æ˜¯ç”±äºOpenZeppelin v5ä½¿ç”¨custom errorså¯¼è‡´çš„ï¼Œè¿™äº›ä¸å½±å“åˆçº¦çš„å®é™…åŠŸèƒ½ï¼š

1. **é”™è¯¯æ¶ˆæ¯æ ¼å¼**: OpenZeppelin v5ä½¿ç”¨custom errorsè€Œä¸æ˜¯stringæ¶ˆæ¯
2. **å‡çº§æµ‹è¯•**: éœ€è¦è¿›ä¸€æ­¥çš„å‡çº§æµ‹è¯•é…ç½®
3. **æµ‹è¯•æ–­è¨€**: æŸäº›æµ‹è¯•çš„æ–­è¨€éœ€è¦è°ƒæ•´ä»¥é€‚åº”æ–°ç‰ˆæœ¬

## æµ‹è¯•ç¯å¢ƒé…ç½®

æµ‹è¯•ä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š

- **Hardhat**: æœ¬åœ°æµ‹è¯•ç½‘ç»œ
- **Ethers.js v6**: ä»¥å¤ªåŠäº¤äº’åº“
- **OpenZeppelin Contracts v5**: å®‰å…¨çš„æ™ºèƒ½åˆçº¦åº“
- **OpenZeppelin Hardhat Upgrades**: åˆçº¦å‡çº§æ’ä»¶
- **Mocha & Chai**: æµ‹è¯•æ¡†æ¶å’Œæ–­è¨€åº“

## ä»£ç è¦†ç›–ç‡

è¦æŸ¥çœ‹ä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼š

```bash
npx hardhat coverage
```

## å®‰å…¨æµ‹è¯•

é¡¹ç›®é›†æˆäº†Slitherå®‰å…¨åˆ†æå·¥å…·ï¼š

```bash
# è¿è¡Œå®Œæ•´å®‰å…¨åˆ†æ
npm run security

# ç”ŸæˆJSONæŠ¥å‘Š
npm run slither:report
```

## æœ€ä½³å®è·µ

1. **æµ‹è¯•éš”ç¦»**: æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä½¿ç”¨`beforeEach`é‡ç½®çŠ¶æ€
2. **å®Œæ•´è¦†ç›–**: æµ‹è¯•æ¶µç›–äº†æ‰€æœ‰publicå’Œexternalå‡½æ•°
3. **è¾¹ç•Œæµ‹è¯•**: åŒ…å«æœ€å¤§ä¾›åº”é‡ã€æƒé™è¾¹ç•Œç­‰è¾¹ç•Œæ¡ä»¶æµ‹è¯•
4. **Gasä¼˜åŒ–**: æä¾›è¯¦ç»†çš„Gasæ¶ˆè€—åˆ†æå’Œä¼˜åŒ–å»ºè®®
5. **é›†æˆæµ‹è¯•**: æ¨¡æ‹ŸçœŸå®ä¸–ç•Œçš„ä½¿ç”¨åœºæ™¯

## è°ƒè¯•æµ‹è¯•

å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è°ƒè¯•ï¼š

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
npx hardhat test --verbose

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
npx hardhat test --grep "æµ‹è¯•åç§°"

# åœ¨æµ‹è¯•ä¸­æ·»åŠ console.logè¿›è¡Œè°ƒè¯•
```

## TypeScriptç±»å‹ä¿®å¤

æœ¬æµ‹è¯•å¥—ä»¶å·²ä¿®å¤æ‰€æœ‰TypeScriptç±»å‹é”™è¯¯ï¼š

### âœ… å·²ä¿®å¤çš„ç±»å‹é—®é¢˜
- **Promiseè¿æ¥é—®é¢˜**: ä¿®å¤äº†`Promise<ContractTransactionResponse>`ä¸Šè°ƒç”¨`.connect()`çš„é”™è¯¯
- **å‡½æ•°ç»‘å®šé”™è¯¯**: ä½¿ç”¨æ­£ç¡®çš„`contract.connect(signer)`æ¨¡å¼
- **BigIntå¤„ç†**: æ­£ç¡®ä½¿ç”¨BigIntè€Œä¸æ˜¯Numberç±»å‹
- **ç±»å‹æ³¨è§£**: ä¸ºæ‰€æœ‰è¿”å›å€¼æ·»åŠ äº†æ˜ç¡®çš„ç±»å‹æ³¨è§£
- **å¯¼å…¥æ ‡å‡†åŒ–**: ç»Ÿä¸€ä½¿ç”¨`import { ethers, upgrades } from "hardhat"`

### ğŸ”§ ç±»å‹å®‰å…¨æœ€ä½³å®è·µ
```typescript
// âœ… æ­£ç¡®çš„ç”¨æˆ·è¿æ¥æ–¹å¼
const userContract = myNFT.connect(user1);
await userContract.mint(user1.address);

// âœ… æ­£ç¡®çš„BigIntæ“ä½œ
const balance: bigint = await myNFT.balanceOf(user1.address);
const total: bigint = balance + 1n;

// âœ… æ­£ç¡®çš„Promiseå¤„ç†
const tx = await myNFT.mint(user1.address);
const receipt = await tx.wait();
```

## æ³¨æ„äº‹é¡¹

1. æµ‹è¯•ä¸­ä½¿ç”¨çš„æ˜¯å¯å‡çº§åˆçº¦æ¨¡å¼ï¼Œæ‰€æœ‰äº¤äº’éƒ½é€šè¿‡ä»£ç†è¿›è¡Œ
2. åˆçº¦å·²é€šè¿‡OpenZeppelinå‡çº§å®‰å…¨æ€§æ£€æŸ¥
3. æ‰€æœ‰æµ‹è¯•éƒ½åŒ…å«é€‚å½“çš„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æƒ…å†µéªŒè¯
4. TypeScriptç±»å‹å®Œå…¨å…¼å®¹ï¼Œæ— ç¼–è¯‘é”™è¯¯
5. ä½¿ç”¨Ethers.js v6å’Œæœ€æ–°çš„Hardhatç±»å‹å®šä¹‰