# Nextswap - ä¼ä¸šçº§å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Solidity](https://img.shields.io/badge/Solidity-0.8.26-blue.svg)](https://solidity.readthedocs.io/)
[![Hardhat](https://img.shields.io/badge/Built%20with-Hardhat-brown.svg)](https://hardhat.org/)

åŸºäºä»¥å¤ªåŠæ„å»ºçš„ç”Ÿäº§çº§ä¼ä¸šå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼Œé‡‡ç”¨ Nextswap V3 é£æ ¼çš„é›†ä¸­æµåŠ¨æ€§ã€NFT å¤´å¯¸è´¨æŠ¼å’ŒæµåŠ¨æ€§æŒ–çŸ¿å¥–åŠ±æœºåˆ¶ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

Nextswap æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„ DEX è§£å†³æ–¹æ¡ˆï¼Œé›†æˆäº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- **é›†ä¸­æµåŠ¨æ€§**ï¼šé‡‡ç”¨ Nextswap V3 é£æ ¼çš„èµ„é‡‘æ•ˆç‡ï¼Œæ”¯æŒå¤šçº§è´¹ç‡
- **NFT å¤´å¯¸ç®¡ç†**ï¼šå°†æµåŠ¨æ€§å¤´å¯¸ä½œä¸º NFT è¿›è¡Œäº¤æ˜“ï¼Œå…·å¤‡å®Œå…¨çš„å¯ç»„åˆæ€§
- **æµåŠ¨æ€§æŒ–çŸ¿**ï¼šè´¨æŠ¼å¤´å¯¸ NFT ä»¥è·å¾— NST å¥–åŠ±
- **ä¼ä¸šçº§å®‰å…¨**ï¼šæ—¶é—´é”æ²»ç†ã€å¤šé‡ç­¾åæ§åˆ¶å’Œå…¨é¢å®¡è®¡
- **å®æ—¶åˆ†æ**ï¼šåŸºäº The Graph æä¾›é€æ˜çš„é“¾ä¸Šæ•°æ®

### æ ¸å¿ƒç‰¹æ€§

- ğŸ”„ **å…‘æ¢** - å³æ—¶ä»£å¸äº¤æ˜“ï¼Œæœ€å°æ»‘ç‚¹
- ğŸ’§ **èµ„é‡‘æ± ** - æ·»åŠ /ç§»é™¤æµåŠ¨æ€§ï¼Œæ”¯æŒçµæ´»çš„ä»·æ ¼èŒƒå›´
- ğŸŒ¾ **æŒ–çŸ¿** - è´¨æŠ¼ V3 NFT å¤´å¯¸èµšå– NST ä»£å¸
- ğŸ“Š **åˆ†æ** - å®æ—¶æŠ•èµ„ç»„åˆè·Ÿè¸ªå’Œå¥–åŠ±
- ğŸ›ï¸ **æ²»ç†** - ç¤¾åŒºé©±åŠ¨çš„åè®®å†³ç­–

## ğŸ“Š ä»£å¸ç»æµæ¨¡å‹ (NST)

### ä»£å¸åˆ†é…

**åˆå§‹æ€»ä¾›åº”é‡ï¼š1,000,000,000 NST (10 äº¿)**
_æ³¨ï¼šæœ€ç»ˆæ€»ä¾›åº”é‡å¯é€šè¿‡ç¤¾ç¾¤æŠ•ç¥¨å†³å®šå¢åŠ _

| ç±»åˆ«            | åˆ†é…æ¯”ä¾‹ | æ•°é‡        | é‡Šæ”¾è§„åˆ™                                |
| --------------- | -------- | ----------- | --------------------------------------- |
| **æµåŠ¨æ€§æŒ–çŸ¿**  | 50%      | 500,000,000 | 4 å¹´çº¿æ€§é‡Šæ”¾ï¼ˆæ¯æ—¥çº¦ 342,465 NSTï¼‰      |
| **å›¢é˜Ÿ & é¡¾é—®** | 15%      | 150,000,000 | 1 å¹´é”ä»“ + 3 å¹´çº¿æ€§é‡Šæ”¾                 |
| **ç”Ÿæ€åŸºé‡‘**    | 20%      | 200,000,000 | å¤šç­¾æ§åˆ¶ï¼Œç”± DAO æˆ–æ ¸å¿ƒå›¢é˜Ÿç®¡ç†         |
| **ç§å‹Ÿè½®**      | 10%      | 100,000,000 | TGE è§£é” 10%ï¼Œä¹‹å 6 ä¸ªæœˆåæ¯æœˆè§£é” 10% |
| **ç¤¾åŒºç©ºæŠ•**    | 5%       | 50,000,000  | TGE æ—¶å¿«ç…§åˆ†å‘                          |

### é‡Šæ”¾æ—¶é—´çº¿

#### æµåŠ¨æ€§æŒ–çŸ¿ï¼ˆ50% - 5 äº¿ NSTï¼‰

- **é‡Šæ”¾å‘¨æœŸ**ï¼š4 å¹´ï¼ˆ48 ä¸ªæœˆï¼‰
- **æ¯æ—¥é‡Šæ”¾**ï¼šçº¦ 342,465 NST
- **é‡Šæ”¾æœºåˆ¶**ï¼š
  - è‡ªåŠ¨è¿›å…¥æŒ–çŸ¿åˆçº¦
  - æ ¹æ®æµåŠ¨æ€§è´¡çŒ®åˆ†é…
  - æ”¯æŒå¤šæ± æŒ–çŸ¿æ¿€åŠ±

#### å›¢é˜Ÿ & é¡¾é—®ï¼ˆ15% - 1.5 äº¿ NSTï¼‰

- **æ‚¬å´–æœŸï¼ˆCliffï¼‰**ï¼š1 å¹´å®Œå…¨é”ä»“
- **çº¿æ€§é‡Šæ”¾æœŸ**ï¼šä¹‹å 3 å¹´çº¿æ€§é‡Šæ”¾
- **æœˆåº¦é‡Šæ”¾**ï¼šçº¦ 4,166,667 NST/æœˆ
- **ç›®çš„**ï¼šé˜²æ­¢æ—©æœŸæŠ›å‹ï¼Œç¡®ä¿é•¿æœŸå‚ä¸

#### ç”Ÿæ€åŸºé‡‘ï¼ˆ20% - 2 äº¿ NSTï¼‰

- **æ§åˆ¶æ–¹å¼**ï¼š3/5 å¤šé‡ç­¾åé’±åŒ…
- **ç”¨é€”**ï¼š
  - æˆ˜ç•¥åˆä½œä¼™ä¼´æ¿€åŠ±
  - ç¤¾åŒºæ´»åŠ¨ä¸ç©ºæŠ•
  - å¼€å‘è€…æ¿€åŠ±è®¡åˆ’
  - æµåŠ¨æ€§å¼•å¯¼è®¡åˆ’
- **é€æ˜åº¦**ï¼šæ‰€æœ‰æ”¯å‡ºéœ€ç¤¾åŒºå…¬ç¤º

#### ç§å‹Ÿè½®ï¼ˆ10% - 1 äº¿ NSTï¼‰

**é‡Šæ”¾è®¡åˆ’**ï¼š

- TGE æ—¶è§£é”ï¼š10,000,000 NSTï¼ˆ10%ï¼‰
- ç¬¬ 6 ä¸ªæœˆï¼šè§£é” 10,000,000 NSTï¼ˆç´¯è®¡ 20%ï¼‰
- ç¬¬ 7-16 ä¸ªæœˆï¼šæ¯æœˆè§£é” 10,000,000 NST
- å…¨éƒ¨è§£é”å®Œæˆï¼šTGE å 16 ä¸ªæœˆ

#### ç¤¾åŒºç©ºæŠ•ï¼ˆ5% - 5000 ä¸‡ NSTï¼‰

- **å‘æ”¾æ–¹å¼**ï¼šTGE æ—¶å¿«ç…§åˆ†å‘
- **ç›®æ ‡ç¾¤ä½“**ï¼š
  - æ—©æœŸæµ‹è¯•ç”¨æˆ·
  - æ´»è·ƒç¤¾åŒºæˆå‘˜
  - ç‰¹å®šè´¡çŒ®è€…
  - å…¶ä»–åè®®äº¤äº’ç”¨æˆ·

### NST ç”¨é€”

- **æ²»ç†æŠ•ç¥¨**ï¼šå‚ä¸åè®®å‚æ•°å†³ç­–å’Œææ¡ˆæŠ•ç¥¨
- **è´¨æŠ¼å¥–åŠ±**ï¼šè´¨æŠ¼ NST è·å–åè®®æ‰‹ç»­è´¹åˆ†æˆ
- **æ‰‹ç»­è´¹æŠ˜æ‰£**ï¼šNST æŒæœ‰è€…äº«å—äº¤æ˜“æ‰‹ç»­è´¹æŠ˜æ‰£
- **æµåŠ¨æ€§æŒ–çŸ¿**ï¼šä½œä¸ºæŒ–çŸ¿å¥–åŠ±çš„ä¸»è¦ä»£å¸
- **ç”Ÿæ€æ¿€åŠ±**ï¼šå‚ä¸ç”Ÿæ€é¡¹ç›®è·å¾—é¢å¤–å¥–åŠ±

### é€šç¼©æœºåˆ¶

- **æ‰‹ç»­è´¹å›è´­**ï¼šéƒ¨åˆ†åè®®æ”¶å…¥ç”¨äºå›è´­å¹¶é”€æ¯ NST
- **ææ¡ˆé”€æ¯**ï¼šç¤¾åŒºå¯ææ¡ˆé”€æ¯éƒ¨åˆ†ç”Ÿæ€åŸºé‡‘
- **ç”Ÿæ€æ¶ˆè´¹**ï¼šç”Ÿæ€é¡¹ç›®æ¶ˆè€— NST ä½œä¸ºæœåŠ¡è´¹ç”¨

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ™ºèƒ½åˆçº¦

```
contracts/
â”œâ”€â”€ tokens/
â”‚   â”œâ”€â”€ NSTToken.sol              # åŸç”Ÿæ²»ç†ä»£å¸
â”‚   â””â”€â”€ TokenDistributor.sol      # å›¢é˜Ÿ/ç”Ÿæ€ä»£å¸åˆ†å‘
â”œâ”€â”€ mining/
â”‚   â””â”€â”€ LiquidityMining.sol       # NFT è´¨æŠ¼ä¸å¥–åŠ±
â”œâ”€â”€ governance/
â”‚   â””â”€â”€ TimelockController.sol    # å®‰å…¨æ²»ç†
â”œâ”€â”€ core/                         # Nextswap V3 æ ¸å¿ƒåˆçº¦
â””â”€â”€ periphery/                    # Nextswap V3 å¤–å›´åˆçº¦
```

### æŠ€æœ¯æ ˆ

- **æ™ºèƒ½åˆçº¦**ï¼šSolidity 0.8.26, OpenZeppelin v5
- **å¼€å‘æ¡†æ¶**ï¼šHardhat
- **å‰ç«¯**ï¼šNext.js 15, React 19, TypeScript
- **Web3**ï¼šEthers.js v6, Wagmi, RainbowKit
- **UI**ï¼šAnt Design, Tailwind CSS
- **æ•°æ®**ï¼šThe Graph Protocol, GraphQL
- **æµ‹è¯•**ï¼šHardhat, Foundryï¼ˆæ¨¡ç³Šæµ‹è¯•ï¼‰
- **å®‰å…¨**ï¼šSlither, MythX

## ğŸ“… å¼€å‘è·¯çº¿å›¾

### é˜¶æ®µ 1ï¼šåŸºç¡€è®¾æ–½å»ºè®¾ï¼ˆç¬¬ 1 å‘¨ï¼‰

- [x] åˆå§‹åŒ– Hardhat é¡¹ç›®
- [x] é›†æˆ Nextswap V3 åˆçº¦
- [x] è®¾è®¡ NST ä»£å¸ç»æµæ¨¡å‹
- [x] é…ç½®å¤šç½‘ç»œæ”¯æŒ
- [x] æ­å»ºæµ‹è¯•ç¯å¢ƒ

### é˜¶æ®µ 2ï¼šæ ¸å¿ƒåˆçº¦å¼€å‘ï¼ˆç¬¬ 2-3 å‘¨ï¼‰

- [x] éƒ¨ç½²å…·æœ‰é“¸é€ æ§åˆ¶çš„ NST Token
- [x] å®ç°ä»£å¸åˆ†å‘çš„çº¿æ€§é‡Šæ”¾
- [x] è®¾ç½®æ—¶é—´é”æ§åˆ¶å™¨
- [x] ä¸ Nextswap V3 é›†æˆ
- [x] å¼€å‘æµåŠ¨æ€§æŒ–çŸ¿åˆçº¦

### é˜¶æ®µ 3ï¼šæµ‹è¯•ä¸å®‰å…¨åŠ å›ºï¼ˆç¬¬ 4 å‘¨ï¼‰

- [ ] å…¨é¢çš„å•å…ƒæµ‹è¯•
- [ ] ä¸»ç½‘åˆ†å‰æµ‹è¯•
- [ ] Foundry æ¨¡ç³Šæµ‹è¯•
- [ ] å®‰å…¨å®¡è®¡ï¼ˆSlither, MythXï¼‰
- [ ] å®¡è®¡å‡†å¤‡å·¥ä½œ

### é˜¶æ®µ 4ï¼šå‰ç«¯å¼€å‘ï¼ˆç¬¬ 5-6 å‘¨ï¼‰

- [ ] å®æ—¶å®šä»·çš„äº¤æ˜“ç•Œé¢
- [ ] æµåŠ¨æ€§æ± ç®¡ç†ç•Œé¢
- [ ] æŒ–çŸ¿è´¨æŠ¼ä»ªè¡¨æ¿
- [ ] æŠ•èµ„ç»„åˆè·Ÿè¸ª
- [ ] ç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡

### é˜¶æ®µ 5ï¼šThe Graph é›†æˆï¼ˆç¬¬ 7 å‘¨ï¼‰

- [ ] å­å›¾æ¨¡å¼å¼€å‘
- [ ] äº‹ä»¶æ˜ å°„å®ç°
- [ ] éƒ¨ç½²åˆ° The Graph Studio
- [ ] å‰ç«¯ GraphQL é›†æˆ
- [ ] å®Œæ•´çš„ Sepolia éƒ¨ç½²

### é˜¶æ®µ 6ï¼šæ–‡æ¡£ä¸ç¤¾åŒºå»ºè®¾ï¼ˆç¬¬ 8 å‘¨ï¼‰

- [ ] å®Œå–„æ–‡æ¡£
- [ ] ä»£å¸ç»æµå­¦ç™½çš®ä¹¦
- [ ] ç”¨æˆ·æŒ‡å—
- [ ] ç¤¾åŒºæ¸ é“
- [ ] æ¼æ´èµé‡‘è®¡åˆ’

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- npm æˆ– yarn
- Git

### å®‰è£…æ­¥éª¤

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-org/next-swap.git
cd next-swap

# å®‰è£…ä¾èµ–
npm install

# å®‰è£…å‰ç«¯ä¾èµ–
cd front && npm install

# å®‰è£…ç›‘æ§æœåŠ¡ä¾èµ–
cd ../offchain-monitor-service && npm install
```

### ç¯å¢ƒé…ç½®

åœ¨æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# ç½‘ç»œé…ç½®
INFURA_PROJECT_ID=your_infura_project_id
PRIVATE_KEY=your_private_key
PRIVATE_KEY_USER1=your_private_key_user1
PRIVATE_KEY_USER2=your_private_key_user2
PRIVATE_KEY_USER3=your_private_key_user3

# ç½‘ç»œåœ°å€
SEPOLIA_RPC_URL=https://sepolia.infura.io/v3/YOUR_PROJECT_ID
MAINNET_RPC_URL=https://mainnet.infura.io/v3/YOUR_PROJECT_ID

# The Graphï¼ˆç”¨äºç›‘æ§ï¼‰
GRAPH_API_KEY=your_graph_api_key

# å‰ç«¯ï¼ˆåœ¨ front/.env.local ä¸­ï¼‰
NEXT_PUBLIC_BASE_API=https://your-api-endpoint.com
NEXT_PUBLIC_APP_TITLE=Nextswap DEX
NEXT_PUBLIC_DEFAULT_LANGUAGE=zh
NEXT_PUBLIC_SUPPORTED_LANGUAGES=zh,en
```

### æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨æœ¬åœ° Hardhat èŠ‚ç‚¹
npx hardhat node

# ç¼–è¯‘åˆçº¦
npx hardhat compile

# è¿è¡Œæµ‹è¯•
npx hardhat test

# éƒ¨ç½²åˆ°æœ¬åœ°ç½‘ç»œ
npm run deploy:all:local

# å¯åŠ¨å‰ç«¯
cd front && npm run dev

# å¯åŠ¨ç›‘æ§æœåŠ¡
cd offchain-monitor-service && npm run dev
```

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# æ‰€æœ‰æµ‹è¯•
npx hardhat test

# è¦†ç›–ç‡æŠ¥å‘Š
npx hardhat coverage

# Gas åˆ†æ
REPORT_GAS=true npx hardhat test

# åˆ†å‰æµ‹è¯•
npx hardhat test --network hardhat --fork https://mainnet.infura.io/v3/YOUR_PROJECT_ID

# æ¨¡ç³Šæµ‹è¯•ï¼ˆéœ€è¦ Foundryï¼‰
forge test --gas-report
```

### å®‰å…¨åˆ†æ

```bash
# é«˜ä¼˜å…ˆçº§é—®é¢˜
npm run security

# å®Œæ•´çš„ Slither åˆ†æ
npm run slither

# ç”ŸæˆæŠ¥å‘Š
npm run slither:report
```

## ğŸ“š æ–‡æ¡£

- [æ¶æ„æ¦‚è§ˆ](./docs/architecture.md)
- [æ™ºèƒ½åˆçº¦ API](./docs/contracts.md)
- [å‰ç«¯æŒ‡å—](./front/README.md)
- [éƒ¨ç½²æŒ‡å—](./docs/deployment.md)
- [å®‰å…¨å®¡è®¡](./docs/audits.md)

## ğŸ” å®‰å…¨æ€§

Nextswap é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜å…ˆä¿éšœå®‰å…¨ï¼š

- **å¤šé‡å®¡è®¡**ï¼šä¸“ä¸šå®‰å…¨å…¬å¸å®¡è®¡
- **æ¼æ´èµé‡‘**ï¼šæ´»è·ƒçš„æ¼æ´èµé‡‘è®¡åˆ’
- **æ—¶é—´é”**ï¼š48 å°æ—¶çš„æ²»ç†å˜æ›´å»¶è¿Ÿ
- **å¤šé‡ç­¾å**ï¼šå›¢é˜Ÿèµ„é‡‘ç”±å¤šé‡ç­¾åé’±åŒ…æ§åˆ¶
- **å¯æš‚åœ**ï¼šç´§æ€¥æš‚åœåŠŸèƒ½
- **å¼€æº**ï¼šå®Œå…¨é€æ˜çš„ä»£ç åº“

### å®‰å…¨æœ€ä½³å®è·µ

1. ç»ä¸åˆ†äº«ç§é’¥æˆ–åŠ©è®°è¯
2. å§‹ç»ˆåœ¨ Etherscan ä¸ŠéªŒè¯åˆçº¦åœ°å€
3. å¤§é¢èµ„é‡‘ä½¿ç”¨ç¡¬ä»¶é’±åŒ…
4. è­¦æƒ•é’“é±¼æ”»å‡»
5. äº¤æ˜“å‰äº†è§£æ™ºèƒ½åˆçº¦é£é™©

## ğŸŒ éƒ¨ç½²

### ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µï¼šPOOL_INIT_CODE_HASH

åœ¨éƒ¨ç½²ä¹‹å‰ï¼Œå¿…é¡»ç†è§£ **POOL_INIT_CODE_HASH** çš„é‡è¦æ€§ï¼š

- **å®šä¹‰**ï¼šNextswapV3Pool åˆçº¦å­—èŠ‚ç çš„ keccak256 å“ˆå¸Œå€¼
- **ç”¨é€”**ï¼šç”¨äº CREATE2 æ¨¡å¼è®¡ç®—æ± å­åœ°å€
- **å…³é”®**ï¼šå¿…é¡»åœ¨éƒ¨ç½²æ‰€æœ‰å¤–å›´åˆçº¦ï¼ˆNPMã€SwapRouterã€QuoterV2ï¼‰ä¹‹å‰ç¡®å®š

**ä½•æ—¶éœ€è¦æ›´æ–° POOL_INIT_CODE_HASHï¼š**

| æ“ä½œ                          | æ˜¯å¦å½±å“å“ˆå¸Œ | éœ€è¦é‡æ–°éƒ¨ç½²å¤–å›´åˆçº¦        |
| ----------------------------- | ------------ | --------------------------- |
| é‡æ–°ç¼–è¯‘ï¼ˆæ— æ”¹åŠ¨ï¼‰            | âŒ ä¸å˜      | âŒ ä¸éœ€è¦                   |
| ä¿®æ”¹ NextswapV3Pool.sol ä»£ç   | âœ… æ”¹å˜      | âœ… **éœ€è¦**                 |
| ä¿®æ”¹ç¼–è¯‘å™¨ç‰ˆæœ¬æˆ–ä¼˜åŒ–è®¾ç½®      | âœ… æ”¹å˜      | âœ… **éœ€è¦**                 |
| ä¿®æ”¹ Pool ä¾èµ–çš„ Library      | âœ… æ”¹å˜      | âœ… **éœ€è¦**                 |
| ä¿®æ”¹å…¶ä»–åˆçº¦ï¼ˆNPM/Router ç­‰ï¼‰ | âŒ ä¸å˜      | âš ï¸ ä»…éœ€é‡æ–°éƒ¨ç½²è¢«ä¿®æ”¹çš„åˆçº¦ |

### ğŸ“‹ å®Œæ•´éƒ¨ç½²æµç¨‹

#### é˜¶æ®µ 0ï¸âƒ£ï¼šå‡†å¤‡å·¥ä½œï¼ˆå…³é”®æ­¥éª¤ï¼‰

```bash
# 1. ç¼–è¯‘æ‰€æœ‰åˆçº¦
npx hardhat compile

# 2. æ£€æŸ¥ POOL_INIT_CODE_HASH æ˜¯å¦åŒ¹é…
npx hardhat run scripts/check_pool_init_code_hash.ts
```

**å¦‚æœè¾“å‡ºæ˜¾ç¤ºä¸åŒ¹é…ï¼š**

```bash
# è¾“å‡ºç¤ºä¾‹ï¼š
# âŒ ä¸åŒ¹é…ï¼éœ€è¦æ›´æ–° PoolAddress.sol
# è¯·å°† PoolAddress.sol ä¸­çš„ POOL_INIT_CODE_HASH æ›´æ–°ä¸º:
# bytes32 internal constant POOL_INIT_CODE_HASH = 0x88c776ac...;

# 3. å¤åˆ¶æ–°å“ˆå¸Œå€¼åˆ° contracts/contract/swap/periphery/libraries/PoolAddress.sol
# æ‰‹åŠ¨æ›´æ–°ä»¥ä¸‹è¡Œï¼š
# bytes32 internal constant POOL_INIT_CODE_HASH = 0xæ–°çš„å“ˆå¸Œå€¼;

# 4. é‡æ–°ç¼–è¯‘ï¼ˆé‡è¦ï¼ï¼‰
npx hardhat compile
```

#### é˜¶æ®µ 1ï¸âƒ£ï¼šéƒ¨ç½²æ ¸å¿ƒåˆçº¦

```bash
# æ­¥éª¤ 1: éƒ¨ç½² NextswapV3Factory
npx hardhat test .\test\deploy_netxtswap.test.ts --network localhost --grep "åº”è¯¥èƒ½éƒ¨ç½²NextswapV3Factory"

# è¾“å‡ºï¼šFactory åœ°å€
# æ‰‹åŠ¨æ“ä½œï¼šå¤åˆ¶åœ°å€åˆ° deployments/localhost-deployment.json
```

**ä¾èµ–å…³ç³»ï¼š** æ—   
**è¾“å‡ºæ–‡ä»¶ï¼š** `deployments/localhost-deployment.json`

```json
{
  "contracts": {
    "NextswapV3Factory": {
      "proxyAddress": "0x..." // â† ç²˜è´´ Factory åœ°å€
    }
  }
}
```

#### é˜¶æ®µ 2ï¸âƒ£ï¼šéƒ¨ç½² NFT ç›¸å…³åº“å’Œåˆçº¦

```bash
# æ­¥éª¤ 2: éƒ¨ç½² NFTDescriptor åº“
npx hardhat test .\test\deploy_netxtswap.test.ts --network localhost --grep "åº”è¯¥å¯ä»¥éƒ¨ç½²NFTDescriptoråº“"

# æ­¥éª¤ 3: éƒ¨ç½² NonfungibleTokenPositionDescriptor
npx hardhat test .\test\deploy_netxtswap.test.ts --network localhost --grep "åº”è¯¥å¯ä»¥éƒ¨ç½²NonfungibleTokenPositionDescriptor"
```

**ä¾èµ–å…³ç³»ï¼š**

- âœ… NFTDescriptorï¼ˆæ­¥éª¤ 2ï¼‰
- âœ… ç½‘ç»œé…ç½®ï¼ˆWETH9, DAI, USDC ç­‰ï¼‰

#### é˜¶æ®µ 3ï¸âƒ£ï¼šéƒ¨ç½²å¤–å›´åˆçº¦ï¼ˆä½¿ç”¨ PoolAddressï¼‰

âš ï¸ **é‡è¦ï¼šè¿™äº›åˆçº¦éƒ½ä¾èµ– PoolAddress.POOL_INIT_CODE_HASHï¼Œå¿…é¡»åœ¨é˜¶æ®µ 0 å®Œæˆåéƒ¨ç½²ï¼**

```bash
# æ­¥éª¤ 4: éƒ¨ç½² SwapRouter
npx hardhat test .\test\deploy_netxtswap.test.ts --network localhost --grep "åº”è¯¥èƒ½éƒ¨ç½²deploySwapRouter"

# æ­¥éª¤ 5: éƒ¨ç½² QuoterV2
npx hardhat test .\test\deploy_netxtswap.test.ts --network localhost --grep "åº”è¯¥èƒ½éƒ¨ç½²Quoter"

# æ­¥éª¤ 6: éƒ¨ç½² NonfungiblePositionManager
npx hardhat test .\test\deploy_netxtswap.test.ts --network localhost --grep "åº”è¯¥èƒ½éƒ¨ç½² NonfungiblePositionManager"
```

**ä¾èµ–å…³ç³»ï¼š**

- âœ… NextswapV3Factoryï¼ˆé˜¶æ®µ 1ï¼‰
- âœ… NonfungibleTokenPositionDescriptorï¼ˆé˜¶æ®µ 2ï¼‰
- âœ… PoolAddress.POOL_INIT_CODE_HASHï¼ˆé˜¶æ®µ 0ï¼‰

#### ğŸ“Š éƒ¨ç½²ä¾èµ–å…³ç³»å›¾

```
é˜¶æ®µ 0: ç¼–è¯‘ & ç¡®å®š POOL_INIT_CODE_HASH
    â†“
é˜¶æ®µ 1: NextswapV3Factory
    â†“
é˜¶æ®µ 2: NFTDescriptor â†’ NonfungibleTokenPositionDescriptor
    â†“
é˜¶æ®µ 3: SwapRouter, QuoterV2, NonfungiblePositionManager
```

#### ğŸ” æ¯æ¬¡éƒ¨ç½²åçš„æ“ä½œ

1. **å¤åˆ¶è¾“å‡ºçš„åˆçº¦åœ°å€**
2. **æ›´æ–° `deployments/localhost-deployment.json`**
3. **ç¡®è®¤ä¸‹ä¸€ä¸ªåˆçº¦çš„ä¾èµ–å·²å°±ç»ª**

### Sepolia æµ‹è¯•ç½‘éƒ¨ç½²

```bash
# é˜¶æ®µ 0: å‡†å¤‡å·¥ä½œ
npx hardhat compile
npx hardhat run scripts/check_pool_init_code_hash.ts
# å¦‚éœ€è¦ï¼Œæ›´æ–° PoolAddress.sol å¹¶é‡æ–°ç¼–è¯‘

# é˜¶æ®µ 1-3: æŒ‰é¡ºåºéƒ¨ç½²ï¼ˆå°† --network localhost æ”¹ä¸º --network sepoliaï¼‰
npx hardhat test .\test\deploy_netxtswap.test.ts --network sepolia --grep "åº”è¯¥èƒ½éƒ¨ç½²NextswapV3Factory"
# ... ä¾æ¬¡æ‰§è¡Œå…¶ä»–æ­¥éª¤

# éªŒè¯åˆçº¦
npm run verify:deployment:sepolia

# å¤åˆ¶ ABI åˆ°å‰ç«¯
npm run copy:abis
```

### ä¸»ç½‘ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# 1. ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
npm run test:all

# 2. è¿è¡Œå®‰å…¨åˆ†æ
npm run security

# 3. æ£€æŸ¥ POOL_INIT_CODE_HASH
npx hardhat run scripts/check_pool_init_code_hash.ts --network mainnet

# 4. éƒ¨ç½²ï¼ˆéœ€è¦å¤šé‡ç­¾åæ‰¹å‡†ï¼‰
# æŒ‰ç…§é˜¶æ®µ 0-3 çš„é¡ºåºé€æ­¥éƒ¨ç½²åˆ°ä¸»ç½‘
npx hardhat test .\test\deploy_netxtswap.test.ts --network mainnet --grep "åº”è¯¥èƒ½éƒ¨ç½²NextswapV3Factory"
# ... ä¾æ¬¡æ‰§è¡Œ

# 5. éƒ¨ç½²åæ£€æŸ¥
npm run verify:deployment:mainnet
```

### âš ï¸ é‡è¦æç¤º

1. **POOL_INIT_CODE_HASH åªéœ€åœ¨ä»¥ä¸‹æƒ…å†µæ›´æ–°ï¼š**

   - ä¿®æ”¹ NextswapV3Pool.sol ä»£ç 
   - æ›´æ”¹ç¼–è¯‘å™¨ç‰ˆæœ¬æˆ–ä¼˜åŒ–è®¾ç½®
   - ä¿®æ”¹ Pool ä¾èµ–çš„ Library

2. **å¦‚æœå“ˆå¸Œä¸åŒ¹é…ï¼š**

   - âŒ æµåŠ¨æ€§æ·»åŠ ä¼šå¤±è´¥ï¼ˆ"Transaction reverted without a reason string"ï¼‰
   - âŒ PoolAddress.computeAddress() ä¼šè®¡ç®—é”™è¯¯çš„æ± åœ°å€
   - âŒ æ‰€æœ‰ä¾èµ– PoolAddress çš„åˆçº¦ï¼ˆNPMã€SwapRouterã€QuoterV2ï¼‰éƒ½éœ€è¦é‡æ–°éƒ¨ç½²

3. **éªŒè¯å‘½ä»¤ï¼š**
   ```bash
   # éšæ—¶è¿è¡Œæ­¤å‘½ä»¤æ£€æŸ¥å“ˆå¸Œæ˜¯å¦æ­£ç¡®
   npx hardhat run scripts/check_pool_init_code_hash.ts
   ```

## ğŸ¤ è´¡çŒ®

æˆ‘ä»¬æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯¦æƒ…è¯·æŸ¥çœ‹[è´¡çŒ®æŒ‡å—](./CONTRIBUTING.md)ã€‚

### å¼€å‘æµç¨‹

1. Fork ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ª TypeScript æœ€ä½³å®è·µ
- ä½¿ç”¨ ESLint å’Œ Prettier
- ç¼–å†™å…¨é¢çš„æµ‹è¯•
- æ›´æ–°æ–‡æ¡£

## ğŸ“Š ç›‘æ§ä¸åˆ†æ

### å®æ—¶æ•°æ®

- **The Graph**ï¼šå®æ—¶é“¾ä¸Šæ•°æ®
- **ä»ªè¡¨æ¿**ï¼š[app.nextswap.io](https://app.nextswap.io) çš„åˆ†ææ•°æ®
- **API**ï¼šå…¬å…± GraphQL ç«¯ç‚¹

### å…³é”®æŒ‡æ ‡

- æ€»é”ä»“ä»·å€¼ï¼ˆTVLï¼‰
- 24 å°æ—¶äº¤æ˜“é‡
- æ´»è·ƒæµåŠ¨æ€§å¤´å¯¸
- NST è´¨æŠ¼ APR
- åè®®æ‰‹ç»­è´¹æ”¶å…¥

## ğŸŒ ç¤¾åŒº

- **å¾®ä¿¡ç¤¾åŒº**ï¼šæ‰«æäºŒç»´ç åŠ å…¥
- **Discord**ï¼š[åŠ å…¥ç¤¾åŒº](https://discord.gg/nextswap)
- **Twitter**ï¼š[@NextswapDEX](https://twitter.com/nextswapdex)
- **Medium**ï¼š[åšå®¢](https://medium.com/nextswap)
- **Telegram**ï¼š[t.me/nextswap](https://t.me/nextswap)

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

- [Nextswap V3](https://nextswap.org/) - æ ¸å¿ƒ AMM é€»è¾‘
- [OpenZeppelin](https://openzeppelin.com/) - å®‰å…¨çš„æ™ºèƒ½åˆçº¦
- [Hardhat](https://hardhat.org/) - å¼€å‘ç¯å¢ƒ
- [The Graph](https://thegraph.com/) - ç´¢å¼•åè®®

## âš ï¸ å…è´£å£°æ˜

Nextswap æ˜¯ä¸€ä¸ªå®éªŒæ€§åè®®ã€‚ç”¨æˆ·åº”è¯¥ï¼š

- äº†è§£æ™ºèƒ½åˆçº¦é£é™©
- ç»ä¸æŠ•èµ„è¶…è¿‡å¯æ‰¿å—æŸå¤±çš„é‡‘é¢
- è¿›è¡Œè‡ªå·±çš„ç ”ç©¶ï¼ˆDYORï¼‰
- æ³¨æ„æ½œåœ¨çš„ bug æˆ–æ¼æ´

åœ¨ Nextswap ä¸Šäº¤æ˜“æ¶‰åŠé‡‘èé£é™©ã€‚å›¢é˜Ÿä¸å¯¹ä»»ä½•æŸå¤±è´Ÿè´£ã€‚

## ğŸ‡¨ğŸ‡³ ä¸­æ–‡æ”¯æŒ

- **è¯­è¨€æ”¯æŒ**ï¼šå®Œæ•´çš„ä¸­è‹±æ–‡åŒè¯­ç•Œé¢
- **ä¸­æ–‡ç¤¾åŒº**ï¼šæä¾›ä¸“é—¨çš„ä¸­æ–‡å®¢æœå’ŒæŠ€æœ¯æ”¯æŒ
- **æœ¬åœ°åŒ–**ï¼šé’ˆå¯¹ä¸­å›½ç”¨æˆ·ä¼˜åŒ–çš„ä½¿ç”¨ä½“éªŒ
- **åˆè§„æ€§**ï¼šéµå¾ªç›¸å…³åœ°åŒºçš„æ³•å¾‹æ³•è§„

---

**ç”± Nextswap å›¢é˜Ÿç”¨ â¤ï¸ æ„å»º**
